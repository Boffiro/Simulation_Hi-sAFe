
library(hisafer)
library(tidyverse)

# Script

## Setup

#pathToSimulation <- getwd()
pathToSimulation <- setwd(dir = "C:/Users/fsoulard/Documents/Simulations_Hi-sAFe/ClimatsClerMtp/")

profiles <- c("all")

## Setup des runs

inputRuns <- read.csv2(file = "inputRuns.csv")

## Creation des runs

ensembleRun <- vector(mode = "list", length = nrow(inputRuns))

for (i in 1:nrow(inputRuns)) {

  ensembleRun[[i]] <- define_hisafe(path = pathToSimulation,
                               template = inputRuns$AgriculturalSystem[i],
                               exp.name = "TestEffetClimat",
                               SimulationName = inputRuns$RunID[i],
                               profiles = profiles,
                               #weatherFile = "C:/Users/fsoulard/Documents/Simulations_Hi-sAFe/ClimatsClerMtp/weather.wth",
                               #weatherFile = "C:/Users/fsoulard/Documents/Simulations_Hi-sAFe/ClimatsClerMtp/Continental.wth",
                               weatherFile = paste0(pathToSimulation,"/",inputRuns$Climate[i],".wth"),
                               simulationYearStart = inputRuns$YearStart[i],
                               nbSimulations = inputRuns$YearEnd[i] - inputRuns$YearStart[i],
                               #simulationYearStart = 1994,
                               #nbSimulations = 1,
                               mainCropSpecies = paste0(inputRuns$CropSpecies[i],".plt"),
                               mainCropItk = paste0(inputRuns$CropSpecies[i],".tec"),
                               treeSpecies = "poplar.tree")
  
  names(ensembleRun)[[i]] <- inputRuns$RunID[i]
  
  build_hisafe(hip = ensembleRun[[i]])
  
}

## Lancement des runs

for (i in 1:nrow(inputRuns)) {
  
  timestamp()
  
  run_hisafe(hip = ensembleRun[[i]], capsis.path = "C:/Users/fsoulard/Documents/CAPSIS/")
  
  timestamp()
  
}










